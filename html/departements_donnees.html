<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Démographie - Départements & Analyse</title> 
    <link rel="stylesheet" href="/Projet-RCW-S5/style/main.css">
    <link rel="icon" href="/Projet-RCW-S5/images/jaj.png" type="image/png">
</head>
<body>
    <header>
        <h1>Analyse du Taux Naturel de Croissance par Département (2021)</h1>
    </header>
    <nav>
        <a href="index.html">Accueil</a>
        <a href="/html/departements_donnees.html">Départements & Analyse</a>
        <a href="/html/regions_donnees.html">Régions & Analyse</a>
        <a href="/html/departements_liste.html">Liste Départements</a>
        <a href="/html/regions_liste.html">Liste Régions</a>
    </nav>

    <div class="container">
        <div id="map-container" class="visualization-card">
            <h2>Carte du Taux Naturel par Département (‰)</h2>
            <div id="map"></div>
        </div>

        <div id="chart-container">
            <div class="visualization-card" style="margin-bottom: 20px;">
                <h2>Top/Flop 10 Départements</h2>
                <div class="chart-canvas">
                    <canvas id="tauxDepartementChart"></canvas>
                </div>
            </div>
            <div class="visualization-card">
                <h2>Taux Naturel par Région (Comparaison)</h2>
                <div class="chart-canvas">
                    <canvas id="tauxRegionChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container visualization-card" id="debug-panel-container">
        <h2>Statut du Chargement des Données</h2>
        <div id="debug-panel">Initialisation du tableau de bord...</div>
    </div>


    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <script type="module" src="/Projet-RCW-S5/web/script/data_processor.js">
        import { loadAndProcessAllData, aggregateRegionalData } from '../script/data_processor.js';
        import { setupMap } from '../script/map_renderer.js';
        import { setupDepartmentChart, setupRegionChart } from '../script/chart_renderer.js';

        async function initializeDashboard() {
            const finalData = await loadAndProcessAllData();
            
            if (finalData && finalData.length > 0) {
                document.getElementById('debug-panel').innerHTML = `Données chargées et prêtes pour ${finalData.length} départements.`;
                
                const regionalData = aggregateRegionalData(finalData);

                setupMap(finalData);
                setupDepartmentChart(finalData);
                setupRegionChart(regionalData);
                
            } else {
                document.getElementById('debug-panel').innerHTML = `<p class="error-message">ERREUR: Aucune donnée finale pour l'affichage. Vérifiez la console et le panneau de débogage.</p>`;
            }
        }

        initializeDashboard();
    </script>
</body>
</html>